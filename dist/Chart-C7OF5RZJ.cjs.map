{"version":3,"sources":["/Users/jason/Code/streamlined.fi/_charts/dist/Chart-C7OF5RZJ.cjs","../src/BarChart/Chart.js","../src/BarChart/components/ControlSlider.js","../src/BarChart/modules/preventScroll.js","../src/BarChart/modules/useSize.js"],"names":["keys","preventDefault","preventDefaultForScrollKeys","supportsPassive","wheelOpt","wheelEvent","disableScroll","enableScroll","useSize","ref","dependencyArray","fallback","size","setSize","useState","useEffect","observer","el","entries","get","Thumb","left","right","value","scale","max","onMove","theme","props","deltaRef","useRef","handleMouseMove","event","isTouch","dx","nextX","nextValue","handlePointerDown","React","Div"],"mappings":"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","file":"/Users/jason/Code/streamlined.fi/_charts/dist/Chart-C7OF5RZJ.cjs","sourcesContent":[null,"import inRange from 'lodash/inRange';\nimport maxBy from 'lodash/maxBy';\nimport React, { useEffect, useRef, useState } from 'react';\nimport ControlSlider from './components/ControlSlider';\nimport Header from './components/Header';\nimport InnerChart from './components/InnerChart';\nimport { Layer, Rect, Stage } from './components/konva';\nimport MobileDivOverlay from './components/MobileDivOverlay';\nimport XAxis from './components/XAxis';\nimport YAxis from './components/YAxis';\nimport useCallbacks from './modules/useCallbacks';\nimport useConfig from './modules/useConfig';\nimport { Context } from './modules/useContext';\nimport useFrame from './modules/useFrame';\nimport useScales from './modules/useScales';\nimport onVisibilityChange from './modules/visibilityChange';\n\nfunction Chart({ fwdRef, title, data, config: cfg, slider }) {\n  const layerRef = useRef();\n  const [barData, setBarData] = useState(data);\n  const config = useConfig({ title, data: barData, ...cfg });\n  const frame = useFrame(config);\n  const scales = useScales(frame, config);\n  const [dispatch, on, off] = useCallbacks();\n  const [cursor, setCursor] = useState('default');\n  const [menuItems, setMenuItems] = useState({});\n  const [activeScale, setActiveScale] = useState(0);\n  const [renderKey, setRenderKey] = useState(0);\n\n  // slider\n  const steps = maxBy(data, dataSeries => dataSeries?.series?.length)?.series\n    ?.length;\n  const [slices, setSlices] = useState(config.initSlices);\n  const [sliceStart, sliceEnd] = slices;\n\n  useEffect(() => {\n    setSlices(config.initSlices);\n  }, [steps]);\n\n  useEffect(() => {\n    setBarData(\n      [...(data || [])].map(dataSeries => {\n        return {\n          ...dataSeries,\n          series: [...(dataSeries?.series || [])].slice(\n            Math.max(0, steps + sliceStart),\n            steps + sliceEnd,\n          ),\n        };\n      }),\n    );\n  }, [data, sliceStart, sliceEnd]);\n\n  useEffect(() => {\n    let renderCount = 0;\n    onVisibilityChange(visible => {\n      if (visible) {\n        // trigger state change to force rerender on window focus\n        // to fix empty chart phenomenon\n        setRenderKey(renderCount++);\n      }\n    });\n  }, []);\n\n  const context = {\n    config,\n    frame,\n    scales,\n    cursor,\n    setCursor,\n    activeScale,\n    setActiveScale,\n    dispatch,\n    on,\n    off,\n    menuItems,\n    setMenuItems,\n  };\n\n  const konvaEvent = e => ({\n    ...e,\n    inInnerChartRange:\n      inRange(e.evt.offsetX, frame.innerChart.xStart, frame.innerChart.xEnd) &&\n      inRange(e.evt.offsetY, frame.innerChart.yStart, frame.innerChart.yEnd),\n  });\n\n  return (\n    <div>\n      <Stage\n        key={renderKey}\n        ref={fwdRef}\n        width={config.width}\n        height={config.height}\n        style={{ cursor }}\n        onContextMenu={e => e.evt.preventDefault()}\n        onClick={e => dispatch('click', konvaEvent(e))}\n        onMouseDown={e => dispatch('mousedown', konvaEvent(e))}\n        onMouseUp={e => dispatch('mouseup', konvaEvent(e))}\n        onMouseMove={e => dispatch('mousemove', konvaEvent(e))}\n      >\n        <Context.Provider value={context}>\n          <Layer ref={layerRef}>\n            <Rect\n              x={0}\n              y={0}\n              width={config.width}\n              height={config.height}\n              fill={config.theme.bgColor}\n              cornerRadius={config.theme.borderRadius}\n            />\n            <Header />\n            <XAxis />\n            <YAxis />\n            <InnerChart layerRef={layerRef} />\n          </Layer>\n          <MobileDivOverlay />\n        </Context.Provider>\n      </Stage>\n      {slider && (\n        <div style={{ paddingTop: config.theme.slider.padding }}>\n          <ControlSlider\n            max={steps}\n            value={slices.map(v => v + steps)}\n            onInput={([min, max]) => {\n              setSlices([min - steps, max - steps]);\n            }}\n            theme={config.theme.slider}\n          />\n        </div>\n      )}\n    </div>\n  );\n}\n\nexport default Chart;\n","import Div from '@streamlinedfi/div';\nimport React, { useEffect, useRef, useState } from 'react';\nimport { disableScroll, enableScroll } from '../modules/preventScroll';\nimport useSize from '../modules/useSize';\n\nconst Thumb = ({ left, right, value, scale, max, onMove, theme, ...props }) => {\n  const deltaRef = useRef();\n\n  const handleMouseMove = event => {\n    /* eslint-disable no-param-reassign */\n    if (deltaRef.current) {\n      const isTouch = event.type === 'touchmove';\n      deltaRef.current.deltaX =\n        (isTouch ? event.touches[0].clientX : event.clientX) -\n        deltaRef.current.initX;\n      const dx = deltaRef.current.deltaX;\n\n      if (left) {\n        const nextX = Math.min(Math.max(0, scale(value[0]) + dx), scale(max));\n        const nextValue = scale.invert(nextX);\n\n        onMove(\n          nextValue < value[1] ? [nextValue, value[1]] : [value[1], nextValue],\n        );\n      } else {\n        const nextX = Math.min(Math.max(0, scale(value[1]) + dx), scale(max));\n        const nextValue = scale.invert(nextX);\n\n        onMove(\n          nextValue > value[0] ? [value[0], nextValue] : [nextValue, value[0]],\n        );\n      }\n\n      if (window.getSelection) {\n        window.getSelection().removeAllRanges();\n      } else if (document.selection) {\n        document.selection.empty();\n      }\n    }\n  };\n\n  const handlePointerDown = event => {\n    const isTouch = event.type === 'touchstart';\n    deltaRef.current = {};\n    deltaRef.current.initX = isTouch ? event.touches[0].clientX : event.clientX;\n    disableScroll();\n\n    document.body.addEventListener(\n      isTouch ? 'touchmove' : 'mousemove',\n      handleMouseMove,\n    );\n\n    document.body.addEventListener(\n      isTouch ? 'touchend' : 'pointerup',\n      () => {\n        document.body.removeEventListener(\n          isTouch ? 'touchmove' : 'mousemove',\n          handleMouseMove,\n        );\n        deltaRef.current = null;\n        enableScroll();\n      },\n      { once: true },\n    );\n  };\n\n  return (\n    <Div\n      as=\"button\"\n      type=\"button\"\n      // role=\"slider\"\n      aria-label={`Slider Thumb ${left ? 'Lower' : 'Upper'}`}\n      $absolute\n      $flex\n      $top={-10}\n      $left={left ? -16 : undefined}\n      $right={right ? -16 : undefined}\n      $innerCenter\n      $w={32}\n      $h={32}\n      $radius={16}\n      $cursor=\"ew-resize\"\n      $background={theme.thumbBackground}\n      $border={theme.thumbBorder}\n      $boxShadow=\"0 0 2px 1px rgba(0, 0, 0, .3)\"\n      onMouseDown={handlePointerDown}\n      onTouchStart={handlePointerDown}\n      {...props}\n    >\n      <Div\n        $w={1.5}\n        $h={12}\n        $background={theme.thumbHandleLineColor}\n        $mr=\"2px\"\n      />\n      <Div $w={1.5} $h={12} $background={theme.thumbHandleLineColor} />\n    </Div>\n  );\n};\n\nexport default function ControlSlider({ max, value, onInput, theme }) {\n  const ref = useRef();\n  const scaleRef = useRef();\n  const [scaleLoaded, setScaleLoaded] = useState();\n  const [width] = useSize(ref);\n  const scale = scaleRef.current;\n  const [leftValue, rightValue] = value;\n\n  useEffect(() => {\n    if (width) {\n      import('d3-scale').then(({ scaleLinear }) => {\n        scaleRef.current = scaleLinear()\n          .domain([0, max])\n          .range([0, width]);\n\n        setScaleLoaded(true);\n      });\n    }\n  }, [max, width]);\n\n  return (\n    <Div $px={1}>\n      <Div\n        ref={ref}\n        $relative\n        $h={12}\n        $w=\"100%\"\n        $radius={theme.borderRadius}\n        $background={theme.background}\n        $border={theme.border}\n      >\n        {scaleLoaded && (\n          <Div\n            $absolute\n            $h={12}\n            $left={Math.max(0, scale(leftValue))}\n            $right={Math.min(width, width - scale(rightValue))}\n            $background={theme.filledTrackColor}\n            $border={theme.filledTrackBorderColor}\n          >\n            <Thumb\n              left\n              value={value}\n              scale={scale}\n              max={max}\n              onMove={onInput}\n              theme={theme}\n            />\n            <Thumb\n              right\n              value={value}\n              scale={scale}\n              max={max}\n              onMove={onInput}\n              theme={theme}\n            />\n          </Div>\n        )}\n      </Div>\n    </Div>\n  );\n}\n","const keys = { 37: 1, 38: 1, 39: 1, 40: 1 };\n\nfunction preventDefault(e) {\n  e.preventDefault();\n}\n\n// eslint-disable-next-line consistent-return\nfunction preventDefaultForScrollKeys(e) {\n  if (keys[e.keyCode]) {\n    preventDefault(e);\n    return false;\n  }\n}\n\n// modern Chrome requires { passive: false } when adding event\nlet supportsPassive = false;\ntry {\n  window.addEventListener(\n    'test',\n    null,\n    Object.defineProperty({}, 'passive', {\n      get() {\n        supportsPassive = true;\n      },\n    }),\n  );\n} catch (e) {}\n\nconst wheelOpt = supportsPassive ? { passive: false } : false;\nconst wheelEvent =\n  'onwheel' in document.createElement('div') ? 'wheel' : 'mousewheel';\n\nexport function disableScroll() {\n  window.addEventListener('DOMMouseScroll', preventDefault, false);\n  window.addEventListener(wheelEvent, preventDefault, wheelOpt);\n  window.addEventListener('touchmove', preventDefault, wheelOpt);\n  window.addEventListener('keydown', preventDefaultForScrollKeys, false);\n}\n\nexport function enableScroll() {\n  window.removeEventListener('DOMMouseScroll', preventDefault, false);\n  window.removeEventListener(wheelEvent, preventDefault, wheelOpt);\n  window.removeEventListener('touchmove', preventDefault, wheelOpt);\n  window.removeEventListener('keydown', preventDefaultForScrollKeys, false);\n}\n","/* eslint-disable consistent-return */\nimport get from 'lodash/get';\nimport { useEffect, useState } from 'react';\n\n// can be controlled using dep array or else use resize observer\nexport default function useSize(\n  ref,\n  dependencyArray = [],\n  fallback = typeof window !== 'undefined' && document.body,\n) {\n  const [size, setSize] = useState({});\n\n  useEffect(() => {\n    let observer;\n\n    const el = ref?.current || fallback;\n\n    if (el) {\n      setSize({\n        width: el.clientWidth,\n        height: el.clientHeight,\n      });\n\n      if (!dependencyArray.length) {\n        observer = new ResizeObserver(entries => {\n          // Wrap it in requestAnimationFrame to avoid this error - ResizeObserver loop limit exceeded\n          requestAnimationFrame(() => {\n            setSize({\n              width: get(entries, '0.target.clientWidth', 0),\n              height: get(entries, '0.target.clientHeight', 0),\n            });\n          });\n        });\n\n        observer.observe(el);\n      }\n    }\n\n    return () => {\n      if (observer) {\n        observer.disconnect();\n        observer = null;\n      }\n    };\n  }, [ref?.current, ...dependencyArray]);\n\n  return [size.width, size.height, size.breakpoints || {}];\n}\n"]}