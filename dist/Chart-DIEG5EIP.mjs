import"./chunk-AHONOM5Y.mjs";import dt from"lodash/inRange";import ur from"lodash/maxBy";import T,{useEffect as ve,useRef as hr,useState as Z}from"react";import j from"@streamlinedfi/div";import $,{useEffect as ht,useRef as de,useState as xt}from"react";var ct={37:1,38:1,39:1,40:1};function P(e){e.preventDefault()}function we(e){if(ct[e.keyCode])return P(e),!1}var Ee=!1;try{window.addEventListener("test",null,Object.defineProperty({},"passive",{get(){Ee=!0}}))}catch{}var te=Ee?{passive:!1}:!1,Me="onwheel"in document.createElement("div")?"wheel":"mousewheel";function ze(){window.addEventListener("DOMMouseScroll",P,!1),window.addEventListener(Me,P,te),window.addEventListener("touchmove",P,te),window.addEventListener("keydown",we,!1)}function De(){window.removeEventListener("DOMMouseScroll",P,!1),window.removeEventListener(Me,P,te),window.removeEventListener("touchmove",P,te),window.removeEventListener("keydown",we,!1)}import Le from"lodash/get";import{useEffect as ft,useState as ut}from"react";function le(e,t=[],r=typeof window<"u"&&document.body){let[n,o]=ut({});return ft(()=>{let i,a=e?.current||r;return a&&(o({width:a.clientWidth,height:a.clientHeight}),t.length||(i=new ResizeObserver(s=>{requestAnimationFrame(()=>{o({width:Le(s,"0.target.clientWidth",0),height:Le(s,"0.target.clientHeight",0)})})}),i.observe(a))),()=>{i&&(i.disconnect(),i=null)}},[e?.current,...t]),[n.width,n.height,n.breakpoints||{}]}var Ae=({left:e,right:t,value:r,scale:n,max:o,onMove:i,theme:a,...s})=>{let l=de(),d=m=>{if(l.current){let f=m.type==="touchmove";l.current.deltaX=(f?m.touches[0].clientX:m.clientX)-l.current.initX;let c=l.current.deltaX;if(e){let u=Math.min(Math.max(0,n(r[0])+c),n(o)),p=n.invert(u);i(p<r[1]?[p,r[1]]:[r[1],p])}else{let u=Math.min(Math.max(0,n(r[1])+c),n(o)),p=n.invert(u);i(p>r[0]?[r[0],p]:[p,r[0]])}window.getSelection?window.getSelection().removeAllRanges():document.selection&&document.selection.empty()}},x=m=>{let f=m.type==="touchstart";l.current={},l.current.initX=f?m.touches[0].clientX:m.clientX,ze(),document.body.addEventListener(f?"touchmove":"mousemove",d),document.body.addEventListener(f?"touchend":"pointerup",()=>{document.body.removeEventListener(f?"touchmove":"mousemove",d),l.current=null,De()},{once:!0})};return $.createElement(j,{as:"button",type:"button","aria-label":`Slider Thumb ${e?"Lower":"Upper"}`,$absolute:!0,$flex:!0,$top:-10,$left:e?-16:void 0,$right:t?-16:void 0,$innerCenter:!0,$w:32,$h:32,$radius:16,$cursor:"ew-resize",$background:a.thumbBackground,$border:a.thumbBorder,$boxShadow:"0 0 2px 1px rgba(0, 0, 0, .3)",onMouseDown:x,onTouchStart:x,...s},$.createElement(j,{$w:1.5,$h:12,$background:a.thumbHandleLineColor,$mr:"2px"}),$.createElement(j,{$w:1.5,$h:12,$background:a.thumbHandleLineColor}))};function me({max:e,value:t,onInput:r,theme:n}){let o=de(),i=de(),[a,s]=xt(),[l]=le(o),d=i.current,[x,m]=t;return ht(()=>{l&&import("d3-scale").then(({scaleLinear:f})=>{i.current=f().domain([0,e]).range([0,l]),s(!0)})},[e,l]),$.createElement(j,{$px:1},$.createElement(j,{ref:o,$relative:!0,$h:12,$w:"100%",$radius:n.borderRadius,$background:n.background,$border:n.border},a&&$.createElement(j,{$absolute:!0,$h:12,$left:Math.max(0,d(x)),$right:Math.min(l,l-d(m)),$background:n.filledTrackColor,$border:n.filledTrackBorderColor},$.createElement(Ae,{left:!0,value:t,scale:d,max:e,onMove:r,theme:n}),$.createElement(Ae,{right:!0,value:t,scale:d,max:e,onMove:r,theme:n}))))}import K from"react";import I,{forwardRef as H}from"react";import{Stage as pt,Layer as gt,Group as yt,Rect as St,Circle as kt,Text as Ct,Line as bt,Image as vt}from"react-konva";var Te=H((e,t)=>I.createElement(pt,{ref:t,...e,preventDefault:!1})),re=H((e,t)=>I.createElement(gt,{ref:t,...e,preventDefault:!1})),A=H((e,t)=>I.createElement(yt,{ref:t,...e,preventDefault:!1})),B=H((e,t)=>I.createElement(St,{ref:t,...e,preventDefault:!1})),q=H((e,t)=>I.createElement(kt,{ref:t,...e,preventDefault:!1})),We=H((e,t)=>I.createElement(Ct,{ref:t,...e,preventDefault:!1})),E=H((e,t)=>I.createElement(bt,{ref:t,...e,preventDefault:!1})),zr=H((e,t)=>I.createElement(vt,{ref:t,...e,preventDefault:!1}));import wt,{useContext as Et}from"react";var ce=wt.createContext();function S(){return Et(ce)}import Dt from"konva";import oe,{forwardRef as Lt}from"react";import fe from"lodash/isNil";var{fromEntries:Mt,entries:zt}=Object;function ue(e){return Array.isArray(e)?e.map(ue).filter(t=>!fe(t)):typeof e=="object"&&!fe(e)?Mt(zt(e).map(([t,r])=>[t,ue(r)]).filter(([t,r])=>!fe(r))):e}var ne=ue;function At(e,t){let{config:r}=S(),n={fontFamily:r.theme.fontFamily,fontSize:r.theme.fontSize,fontStyle:r.theme.fontStyle,fill:r.theme.color,...ne(e)};function o(){return Math.ceil(new Dt.Text(n).getTextWidth())}return oe.createElement(oe.Fragment,null,e.bgFill&&oe.createElement(B,{x:e.x,y:e.y,offsetX:e.bgPadding,offsetY:e.bgPadding,width:o()+e.bgPadding*2,height:n.fontSize+e.bgPadding*2,fill:e.bgFill}),oe.createElement(We,{ref:t,...n}))}var L=Lt(At);function Tt(){let{frame:e,config:t,setActiveScale:r,setCursor:n}=S();return K.createElement(K.Fragment,null,K.createElement(L,{text:t.title,x:e.header.xStart,y:e.header.yStart,fontFamily:t.theme.title.fontFamily,fontSize:t.theme.title.fontSize,fill:t.theme.title.color}),t.data.map((o,i)=>({dataset:o,index:i,xStart:e.legend.items[i].xStart,yStart:e.legend.items[i].yStart,color:t.theme.colors[i]})).map(({dataset:o,index:i,xStart:a,yStart:s,color:l})=>K.createElement(A,{key:o.name+i,onClick:t.sharedScale?void 0:()=>r(i),onMouseEnter:t.sharedScale?void 0:()=>n("pointer"),onMouseLeave:t.sharedScale?void 0:()=>n("default")},K.createElement(q,{x:a,y:s+t.theme.legend.circle.positionTop,radius:t.theme.legend.circle.size/2,offsetX:-t.theme.legend.circle.size/2,offsetY:-t.theme.legend.circle.size/2,stroke:l,strokeWidth:t.theme.legend.circle.lineWidth}),K.createElement(B,{x:a+t.theme.legend.circle.size,y:s,width:t.theme.legend.circle.marginRight,height:t.theme.legend.fontSize}),K.createElement(L,{text:o.name,x:a+t.theme.legend.circle.size+t.theme.legend.circle.marginRight,y:s,fontFamily:t.theme.legend.fontFamily||t.theme.fontFamily,fontSize:t.theme.legend.fontSize,fill:t.theme.legend.color}))))}var Be=Tt;import{mix as jt}from"polished";import _,{useEffect as _t,useRef as Jt}from"react";function U(e,t){t||(console.log(e),console.log(t));let r=t.x.step()*(1-e.theme.axes.xInnerSpacingBarMultiplier),n=e.data.length,o=Math.min(Math.max(e.theme.bar.minWidth,r/n*e.theme.bar.spaceMultiplier),e.theme.bar.maxSpace),i=r/n-o,a=Math.min(Math.max(e.theme.bar.minWidth,i),e.theme.bar.maxWidth);return{barWidth:a,getBarX:(l,d)=>t.x(d)+(a+o)*l}}function Q(e,t){let r=e.data.map((n,o)=>[n,o]).reverse();return r.push(r.splice(r.findIndex(([,n])=>n===t),1)[0]),r}import{useEffect as Wt,useRef as Fe,useCallback as Bt}from"react";import $e from"konva";var he=e=>!Number.isNaN(e)&&![0,null,void 0].includes(e),Ie=(e,t)=>!(e==="Rect"&&![t.x,t.y,t.width,t.height].every(he)||e==="Line"&&!t.points.every(he)||(e==="Circle"||e==="Text")&&![t.x,t.y].every(he));function xe(e){let{config:t,frame:r}=S(),n=Fe([]),o=Fe({}),i=Bt((s,l)=>{if(!l||!Ie(l.type,l))return null;let{key:d,show:x=!0}=l,m=o.current[d];if(!x)return m&&(m.destroy(),delete o.current[d]),null;let f=s({config:t,frame:r,node:m,...l}).filter(u=>u&&Ie(u.type,u.attrs));if(!f||!f.length)return m&&(m.destroy(),delete o.current[d]),null;if(m)return f.forEach((u,p)=>{try{m.children[p].setAttrs(u.attrs)}catch{}}),m;let c=new $e.Group({key:d});return f.forEach(u=>{let p=new $e[u.type](u.attrs);c.add(p)}),e.add(c),o.current[d]=c,c},[e?._id,JSON.stringify(r)]);Wt(()=>{e?._id&&n.current.forEach(([s,l])=>{i(s,l)})},[e?._id]);function a(s,l){return e?.add?i(s,l):(n.current.push([s,l]),null)}return a.destroy=s=>{o.current[s]&&(o.current[s].destroy(),delete o.current[s])},a.destroyAll=()=>{Object.keys(o.current).forEach(s=>{o.current[s]?.destroy(),delete o.current[s]})},a}import It from"lodash/inRange";import N,{useEffect as He,useState as Oe}from"react";import ie from"react";import{mix as Ft}from"polished";function $t({y:e,text:t,fill:r,onClick:n}){let{frame:o,config:i,setCursor:a}=S(),s=i.theme.axes.lastValueTickBgSize;return ie.createElement(A,{onClick:n,onMouseEnter:n?()=>a("pointer"):void 0,onMouseLeave:n?()=>a("default"):void 0},ie.createElement(E,{fill:Ft(.2,r,i.theme.bgColor),points:[o.yAxis.xStart,e,o.yAxis.xStart+s/2,e-s/2,o.yAxis.xEnd,e-s/2,o.yAxis.xEnd,e+s/2,o.yAxis.xStart+s/2,e+s/2,o.yAxis.xStart,e],closed:!0}),ie.createElement(E,{stroke:r,strokeWidth:1,points:[o.yAxis.xStart,e,o.yAxis.xStart+i.theme.axes.tickSize,e]}),ie.createElement(L,{text:t,x:o.yAxis.xStart+i.theme.axes.tickSize+i.theme.axes.tickMargin,y:e+1,offsetY:i.theme.axes.fontSize/2,fill:r,fontSize:i.theme.axes.fontSize}))}var se=$t;var pe="crosshair";function Ht(){return"ontouchstart"in window||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0}function Ot(e,t,r){let n={};for(let o=0;o<e.data.length;o++){let i=e.data[o],a=t[e.sharedScale?0:o],{barWidth:s,getBarX:l}=U(e,a);for(let d=0;d<i.series.length;d++){let m=l(o,i.series[d].x)+s/2,f=Math.abs(m-r);(!Object.keys(n).length||f<n.diff)&&(n.dataset=d,n.i=d,n.diff=f,n.x=m,n.xText=i.series[d].x,n.y=a.y(i.series[d].y),n.meta=i.series[d].meta)}}return n}function Xt(){let{scales:e,frame:t,config:r,activeScale:n,on:o,off:i,tool:a}=S(),[s,l]=Oe({x:null,y:null}),[d,x]=Oe({x:null,y:null}),m=d.x||s.x,f=d.y||s.y,c="",u=!!m&&It(m,t.innerChart.xStart,t.innerChart.xEnd);if(u){let y=Ot(r,e,m);m=y.x,c=y.xText,f=y.y}let p=r.formatters.crosshair.y(e[n].y.invert(f));return He(()=>{a!=="crosshair"&&x({x:null,y:null})},[a]),He(()=>(o("mousemove",({inInnerChartRange:y,evt:v})=>{l({x:y?v.offsetX:null,y:y?v.offsetY:null})},pe),()=>{i("mousemove",pe),i("click",pe)}),[d,a,l]),!u||Ht()?null:N.createElement(N.Fragment,null,N.createElement(E,{stroke:r.theme.crosshair.lineColor,strokeWidth:1,dash:r.theme.crosshair.lineDash,points:[m,t.innerChart.yStart,m,t.innerChart.yEnd]}),N.createElement(E,{stroke:r.theme.crosshair.tickColor,strokeWidth:1,points:[m,t.xAxis.yStart,m,t.xAxis.yStart+r.theme.axes.tickSize]}),N.createElement(L,{text:c,x:m,y:t.xAxis.yStart+r.theme.axes.tickSize+r.theme.axes.tickMargin,fontSize:r.theme.axes.fontSize,fill:r.theme.crosshair.color,bgPadding:1,bgFill:r.theme.bgColor}),N.createElement(E,{stroke:r.theme.crosshair.lineColor,strokeWidth:1,dash:r.theme.crosshair.lineDash,points:[t.innerChart.xStart,f,t.innerChart.xEnd,f]}),N.createElement(se,{y:f,text:p,fill:r.theme.crosshair.color}))}var Xe=Xt;import X,{useState as R,useRef as Yt,useEffect as G,useCallback as Ye}from"react";var{keys:Pe,values:Ke,fromEntries:Ne,entries:Ge}=Object,O="linedrawings";function Pt({line:e,selectedLine:t,setSelectedLine:r,setMovingLine:n,mousePos:o}){let{frame:i,config:a,setCursor:s}=S(),[l,d]=R(!1),x=[];return e.type==="line"&&(x=e.points[2]?e.points:[e.points[0],e.points[1],o.x,o.y]),e.type==="vline"&&(x=[e.points[0],i.innerChart.yStart,e.points[0],i.innerChart.yEnd]),e.type==="hline"&&(x=[i.innerChart.xStart,e.points[1],i.innerChart.xEnd,e.points[1]]),X.createElement(A,{onMouseEnter:()=>{s("grab"),d(!0)},onMouseLeave:()=>{s("default"),d(!1)},onClick:()=>{r(e.id)}},(e.type!=="line"||e.points[2])&&X.createElement(E,{stroke:"transparent",strokeWidth:a.theme.lineCircleSize,points:x,onMouseDown:()=>{n([e.id,"both"])}}),X.createElement(E,{stroke:e.stroke,strokeWidth:e.strokeWidth,points:x}),(t===e.id||l)&&X.createElement(X.Fragment,null,X.createElement(q,{x:e.points[0],y:e.points[1],radius:a.theme.lineCircleSize/2,fill:a.theme.bgColor,stroke:e.stroke,strokeWidth:e.strokeWidth,onMouseDown:()=>{n([e.id,0])}}),e.type==="line"&&e.points[2]&&X.createElement(q,{x:e.points[2],y:e.points[3],radius:a.theme.lineCircleSize/2,fill:a.theme.bgColor,stroke:e.stroke,strokeWidth:e.strokeWidth,onMouseDown:()=>{n([e.id,1])}})))}function Kt(){let{tool:e,setTool:t,config:r,setCursor:n,on:o,off:i,menuItems:a,setMenuItems:s}=S(),l=Yt(),[d,x]=R({}),[m,f]=R({}),[c,u]=R(null),[p,y]=R(null),v=["line","hline","vline"].includes(e),z=Ye((h,w)=>{let k=Pe(m).sort().reverse()[0],C=m[k];if(!C||C.type!=="line"||C.points[2]){let M=Date.now();f({...m,[M]:{id:M,type:e,stroke:r.theme.lineColor,strokeWidth:r.theme.lineWidth,points:[h,w]}}),u(M),e!=="line"&&t("crosshair")}else f({...m,[C.id]:{...C,stroke:r.theme.lineColor,strokeWidth:r.theme.lineWidth,points:[...C.points,h,w]}}),t("crosshair")},[m,e]),W=Ye((h,w)=>{let[k,C]=p,M=m[k],Y=[h,w];if(M.type==="line")if(C==="both"){let D=l.current;D.points||(D.points=M.points),Y=[D.points[0]+h-D.x,D.points[1]+w-D.y,D.points[2]+h-D.x,D.points[3]+w-D.y]}else C===0?Y=[h,w,M.points[2],M.points[3]]:C===1&&(Y=[M.points[0],M.points[1],h,w]);f({...m,[M.id]:{...M,points:Y}})},[m,p]);return G(()=>(o("mousemove",({inInnerChartRange:h,evt:w})=>{if(h){let k=w.offsetX,C=w.offsetY;x({x:k,y:C}),p&&W(k,C)}},O),()=>{i("mousemove",O)}),[p,W]),G(()=>(o("mousedown",({evt:h})=>{l.current={x:h.offsetX,y:h.offsetY}},O),()=>{i("mousedown",O)}),[]),G(()=>(o("mouseup",()=>{l.current={},y(null)},O),()=>{i("mouseup",O)}),[]),G(()=>(o("innerChartClick",({evt:h})=>{u(null),v&&z(h.offsetX,h.offsetY)},O),()=>{i("innerChartClick",O)}),[z,v]),G(()=>{let h=w=>{if(["Escape","Backspace","Delete"].includes(w.key)){let k=Ke(m).find(C=>C.type==="line"&&!C.points[2]);k&&f(Ne(Ge(m).filter(([C])=>C!==k.id)))}};return document.addEventListener("keydown",h),()=>{document.removeEventListener("keydown",h)}},[m]),G(()=>{p&&n("grabbing")},[p]),G(()=>{Pe(m).length?s({...a,removeSelected:c!==null?{text:"Remove Drawing",onClick:()=>{f(Ne(Ge(m).filter(([h])=>h!==c)))}}:null,removeAll:{text:"Remove All Drawings",onClick:()=>f([])}}):s({...a,removeSelected:null,removeAll:null})},[JSON.stringify(a),JSON.stringify(m),c]),Ke(m).map(h=>X.createElement(Pt,{key:h.i,line:h,selectedLine:c,setSelectedLine:u,setMovingLine:y,mousePos:d}))}var Ve=Kt;import V,{useState as ge,useEffect as Nt}from"react";var je="menu";function Gt({x:e,y:t,children:r,onClick:n}){let{config:o,setCursor:i}=S(),[a,s]=ge(!1);return V.createElement(A,{onMouseEnter:()=>{s(!0),i("pointer")},onMouseLeave:()=>{s(!1),i("default")},onClick:n},V.createElement(B,{x:e,y:t,width:172,height:o.theme.menu.item.fontSize+o.theme.menu.item.padding*2,fill:a?o.theme.menu.item.bgColorHover:"transparent",cornerRadius:o.theme.menu.item.borderRadius}),V.createElement(L,{text:r,x:e+o.theme.menu.item.padding,y:t+o.theme.menu.item.padding,fontSize:o.theme.menu.item.fontSize,fill:a?o.theme.menu.item.colorHover:o.theme.menu.item.color}))}function Vt(){let{config:e,on:t,off:r,menuItems:n}=S(),[o,i]=ge(),[a,s]=ge(!1),l=e.theme.menu.item.fontSize+e.theme.menu.item.padding*2,d=Object.values(n).filter(Boolean),x=180;if(Nt(()=>(t("click",c=>{a&&c.evt.which===1&&s(!1),c.inInnerChartRange&&c.evt.which===3&&d.length&&(s(!0),i({x:c.evt.offsetX,y:c.evt.offsetY}))},je),()=>{r("click",je)}),[a,o,d.length]),!a||!o)return null;let{x:m,y:f}=o;return V.createElement(V.Fragment,null,V.createElement(B,{x:m,y:f,width:x,height:e.theme.menu.padding*2+l*d.length,stroke:e.theme.menu.borderColor,strokeWidth:e.theme.menu.borderWidth,fill:e.theme.menu.bgColor,cornerRadius:e.theme.menu.borderRadius}),d.map((c,u)=>V.createElement(Gt,{height:l,x:m+e.theme.menu.padding,y:f+e.theme.menu.padding+l*u,onClick:c.onClick},c.text)))}var _e=Vt;var Zt=JSON.stringify;function qt({stroke:e,strokeWidth:t,points:r}){return[{type:"Line",attrs:{points:r,stroke:e,strokeWidth:t,perfectDrawEnabled:!1,listening:!1}}]}function Ut({width:e,height:t,x:r,y:n,fill:o,cornerRadius:i}){return[{type:"Rect",attrs:{x:r,y:n,width:e,height:t,fill:o,cornerRadius:i,perfectDrawEnabled:!1,listening:!1}}]}function Qt({layerRef:e}){let t=xe(e.current),r=Jt([]),{frame:n,scales:o,config:i,activeScale:a,setCursor:s,dispatch:l}=S(),d=Q(i,a);return _t(()=>{t.destroyAll();let x={};return d.forEach(([m,f])=>{let c=o[i.sharedScale?0:f],{barWidth:u,getBarX:p}=U(i,c);m.series.map(y=>{let v=f+y.x+y.y;return x[v]=v,{...y,key:v}}).forEach(({key:y,x:v,y:z,color:W},h)=>{h===0&&(r.current.forEach(k=>{x[k]||t.destroy(k)}),r.current=Object.keys(x));let w=Number(z)>=0;v&&t(Ut,{key:y,x:p(f,v),width:u,fill:W||jt(.1,i.theme.bgColor,i.theme.colors[f]),...w?{y:c.y(z),height:c.y(0)-c.y(z),cornerRadius:[i.theme.bar.borderRadius,i.theme.bar.borderRadius,0,0]}:{y:c.y(0),height:c.y(z)-c.y(0),cornerRadius:[0,0,i.theme.bar.borderRadius,i.theme.bar.borderRadius]}})}),t(qt,{stroke:i.theme.axes.lineColor,strokeWidth:1,points:[n.innerChart.xStart,c.y(0),n.innerChart.xEnd,c.y(0)]})}),()=>{t.destroyAll()}},[l,Zt(d)]),_.createElement(_.Fragment,null,_.createElement(B,{x:n.innerChart.xStart,y:n.innerChart.yStart,width:n.innerChart.width,height:n.innerChart.height,onMouseEnter:()=>s("crosshair"),onMouseLeave:()=>s("default"),onClick:x=>{l("innerChartClick",x)}}),_.createElement(Xe,null),_.createElement(Ve,null),_.createElement(_e,null))}var Je=Qt;import ye from"react";import{Html as Rt}from"react-konva-utils";function Se(){let{config:e}=S();return(typeof window<"u"&&typeof document<"u"?document.body.clientWidth<e.mobileThreshold:!1)?ye.createElement(re,null,ye.createElement(Rt,{divProps:{style:{zIndex:1,width:"100%"}}},ye.createElement("div",{style:{position:"absolute",left:0,top:0,width:e.width,height:e.height}}))):null}import J,{useRef as er}from"react";import tr from"konva";function rr(){let{frame:e,config:t,scales:r,activeScale:n}=S(),o=er(e.xAxis.xStart);return J.createElement(J.Fragment,null,t.data[n].series.map((i,a)=>{let s=r[n].x(i.x);if(a>0&&s<o.current+t.theme.axes.minTickSpaceX)return;let l=t.formatters.axes.x(i.x);return o.current=s+new tr.Text({text:l,fontFamily:t.theme.axes.fontFamily||t.theme.fontFamily,fontStyle:500,fontSize:t.theme.axes.fontSize}).getTextWidth(),J.createElement(A,{key:i.x},t.theme.grid.showX&&J.createElement(E,{points:[s,e.innerChart.yStart,s,e.innerChart.yEnd],stroke:t.theme.grid.lineColor,strokeWidth:1}),J.createElement(E,{points:[s,e.xAxis.yStart,s,e.xAxis.yStart+t.theme.axes.tickSize],stroke:t.theme.axes.tickColor,strokeWidth:1}),J.createElement(L,{text:l,x:s,y:e.xAxis.yStart+t.theme.axes.tickSize+t.theme.axes.tickMargin,fontSize:t.theme.axes.fontSize,fill:t.theme.axes.color}))}))}var Ze=rr;import F,{useRef as nr}from"react";function or(){let{frame:e,config:t,scales:r,activeScale:n,setActiveScale:o}=S(),i=nr(t.height);return F.createElement(F.Fragment,null,r[n].y.ticks().map((a,s)=>{let l=r[n].y(a);if(!(s>0&&l>i.current-t.theme.axes.minTickSpaceY))return i.current=l-t.theme.axes.fontSize,F.createElement(A,{key:a},t.theme.grid.showY&&F.createElement(E,{points:[e.innerChart.xStart,l,e.innerChart.xEnd,l],stroke:t.theme.grid.lineColor,strokeWidth:1}),F.createElement(E,{points:[e.yAxis.xStart,l,e.yAxis.xStart+t.theme.axes.tickSize,l],stroke:t.theme.axes.tickColor,strokeWidth:1}),F.createElement(L,{text:t.formatters.axes.y(a),fontSize:t.theme.axes.fontSize,fill:t.theme.axes.color,x:e.yAxis.xStart+t.theme.axes.tickSize+t.theme.axes.tickMargin,y:l+1,offsetY:t.theme.axes.fontSize/2}))}),Q(t,n).map(([a,s])=>{let l=a.series[a.series.length-1];if(!l)return null;let d=r[t.sharedScale?0:s].y(l.y);return F.createElement(se,{key:a.name+s,y:d,text:t.formatters.axes.y(l.y),fill:t.theme.colors[s],onClick:t.sharedScale?void 0:()=>o(s)})}),F.createElement(E,{stroke:t.theme.axes.lineColor,strokeWidth:1,points:[e.xAxis.xStart,e.xAxis.yStart,e.xAxis.xEnd,e.xAxis.yStart]}),F.createElement(E,{stroke:t.theme.axes.lineColor,strokeWidth:1,points:[e.yAxis.xStart,e.yAxis.yStart,e.yAxis.xStart,e.yAxis.yEnd]}))}var qe=or;import{useRef as ir}from"react";var{values:sr,keys:ar}=Object;function lr(){let e=ir({});return[(o,i)=>{sr(e.current[o]||[]).filter(a=>typeof a=="function").forEach(a=>a(i))},(o,i,a)=>{let s=a||ar(e.current).length;e.current[o]={...e.current[o],[s]:i}},(o,i)=>{delete e.current[o][i]}]}var Ue=lr;import dr from"deepmerge";import Qe from"lodash/round";import Re from"moment-timezone";import{transparentize as et}from"polished";var g={fontFamily:'-apple-system,BlinkMacSystemFont,"Helvetica Neue",sans-serif',colorMap:{0:"#0094FF",1:"#4db705",2:"#d6c103",3:"#e3482d",4:"#e21de7"},primary:"#0094FF",greenCandle:"#24C1B0",redCandle:"#FF5959",fill900:"#F5F7FB",fill800:"#E7EBFA",fill700:"#CAD3ED",fill600:"#ADB7D3",fill500:"#95A0BF",fill400:"#7D88AA",fill300:"#4A5169",fill200:"#3E4459",fill100:"#313747",border:"#3E4459",background:"#232936",backgroundDarker:"#1d222d",backgroundDarkest:"#181c25"},tt={title:"",xKey:"x",yKey:"y",formatters:{axes:{x:e=>Re.tz(e,"America/New_York").format("MMM \u2019YY"),y:(e,t)=>Qe(e,t).toFixed(t)},crosshair:{x:e=>Re.tz(e,"America/New_York").format("D MMM \u2019YY HH:mm"),y:(e,t)=>Qe(e,t).toFixed(t)}},mobileThreshold:768,initSlices:[-16,0],theme:{colors:Object.values(g.colorMap),bgColor:g.backgroundDarker,borderRadius:8,lineColor:g.primary,lineWidth:1.5,lineCircleSize:10,fontFamily:g.fontFamily,fontSize:14,fontStyle:500,color:g.fill600,padding:24,title:{fontSize:14,marginBottom:12,color:g.fill800},legend:{fontSize:13,color:g.fill600,itemMarginRight:12,itemMarginBottom:8,marginBottom:12,circle:{positionTop:-1,size:13,marginRight:6,lineWidth:1.5}},grid:{lineColor:g.fill100,showY:!0,showX:!1},axes:{fontSize:13,color:g.fill500,lineColor:g.fill300,tickColor:g.fill300,tickSize:8,tickMargin:4,lastValueTickBgSize:20,lastValueYAxisGap:16,minTickSpaceX:8,minTickSpaceY:8,xInnerSpacingBarMultiplier:.25,xOuterSpacingBarMultiplier:.5},bar:{borderRadius:6,minWidth:2,maxWidth:24,spaceMultiplier:.25,minSpace:1,maxSpace:12},crosshair:{color:g.fill800,tickColor:g.fill800,tickBgColor:g.fill200,lineColor:g.fill500,lineDash:[3,4]},menu:{bgColor:g.background,borderColor:g.fill300,borderWidth:1,borderRadius:6,padding:6,item:{padding:10,fontSize:13,color:g.fill700,colorHover:g.fill900,bgColorHover:g.backgroundDarker,borderRadius:6}},slider:{padding:16,background:g.backgroundDarker,border:`1px solid ${g.fill300}`,borderRadius:6,filledTrackColor:et(.9,g.primary),filledTrackBorderColor:et(.5,g.primary),thumbBackground:g.background,thumbBorder:`1px solid ${g.fill300}`,thumbHandleLineColor:g.fill500}}};import rt from"lodash/map";var nt=e=>![null,void 0].includes(e)&&!Number.isNaN(e);function ke(e){let{data:t,xKey:r,yKey:n}=e;return!t||!t.length||!t[0]?.series?[{name:"Invalid data",series:[{x:null,y:0},{x:null,y:100}]}]:t.map(o=>{let{name:i,code:a,series:s}=o;return s?.length?s[0].x&&s[0].y?{...o,series:rt(s,d=>({x:d.x,y:nt(d.y)?d.y:0,meta:d.meta,color:d.color}))}:{name:i,code:a,series:rt(s,d=>({x:d[r],y:nt(d[n])?d[n]:0,meta:d.meta,color:d.color}))}:{name:i,code:a,series:s}})}function Ce(e){let t=dr(tt,ne(e));return t.data=ke(t),t}import ot from"konva";function mr(e){let{theme:t}=e,r={xStart:t.padding,xEnd:e.width-t.padding,yStart:t.padding,yEnd:e.height-t.padding},n={xStart:t.padding,yStart:t.padding+t.title.fontSize+t.title.marginBottom,items:[]};e.data.forEach((f,c)=>{let u=Math.ceil(new ot.Text({text:f.name,fontFamily:t.legend.fontFamily||t.fontFamily,fontSize:t.legend.fontSize}).getTextWidth()),p=c===e.data.length-1?0:t.legend.itemMarginRight,y=c===0?n.xStart:n.items[c-1].xEnd,v=c===0?n.yStart:n.items[c-1].yStart,z=y+t.legend.circle.size+t.legend.circle.marginRight+u+p,W=v+t.legend.fontSize+t.legend.marginBottom,h=y,w=v,k=z-p,C=W-t.legend.marginBottom;c>0&&k>r.xEnd&&(y=n.xStart,v=v+t.legend.fontSize+t.legend.itemMarginBottom,z=y+t.legend.circle.size+t.legend.circle.marginRight+u+p,W=v+t.legend.fontSize+t.legend.marginBottom,h=y,w=v,k=z-p,C=W-t.legend.marginBottom),n.items.push({xStart:y,xEnd:z,yStart:v,yEnd:W,xInnerStart:h,xInnerEnd:k,yInnerStart:w,yInnerEnd:C})}),n.yEnd=n.items[n.items.length-1].yEnd;let o={xStart:t.padding,xEnd:e.width-t.padding,yStart:t.padding,yEnd:n.yEnd},i={xStart:r.xStart,xEnd:r.xEnd,yStart:o.yEnd,yEnd:r.yEnd},a=e.data.map(f=>{let c=f.series[f.series.length-1],u=new ot.Text({text:e.formatters.axes.y(c?.y),fontFamily:t.axes.fontFamily||t.fontFamily,fontSize:t.axes.fontSize}).getTextWidth();return Math.ceil(u)}),s=t.axes.tickSize+t.axes.tickMargin+Math.max(...a)+t.axes.tickMargin,l=t.axes.tickSize+t.axes.tickMargin+t.axes.fontSize,d={xStart:r.xStart,xEnd:r.xEnd-s,width:r.xEnd-s-r.xStart,yStart:o.yEnd,yEnd:r.yEnd-l,height:r.yEnd-l-o.yEnd},x={xStart:d.xStart,xEnd:d.xEnd,yStart:d.yEnd,yEnd:d.yEnd},m={xStart:d.xEnd,xEnd:i.xEnd,yStart:d.yStart,yEnd:d.yEnd};return{inner:r,header:o,legend:n,outerChart:i,innerChart:d,xAxis:x,yAxis:m}}var it=mr;import cr from"lodash/maxBy";import{scaleLinear as st,scaleBand as at}from"d3-scale";function be(e,t){if(t.sharedScale){let n=at().domain(cr(t.data,a=>a.series.length).series.map(({x:a})=>a)).range([e.innerChart.xStart,e.innerChart.xEnd]).paddingInner(t.theme.axes.xInnerSpacingBarMultiplier).paddingOuter(t.theme.axes.xOuterSpacingBarMultiplier),o=t.data.map(({series:a})=>a.map(({y:s})=>s)).flat(1),i=st().domain([Math.min(...o,0),Math.max(...o,0)]).range([e.innerChart.yEnd,e.innerChart.yStart]).nice();return[{x:n,y:i}]}return t.data.map(({series:n})=>{let o=at().domain(n.map(({x:s})=>s)).range([e.innerChart.xStart,e.innerChart.xEnd]).paddingInner(t.theme.axes.xInnerSpacingBarMultiplier).paddingOuter(t.theme.axes.xOuterSpacingBarMultiplier),i=n.map(({y:s})=>s),a=st().domain([Math.min(0,...i),Math.max(0,...i)]).range([e.innerChart.yEnd,e.innerChart.yStart]).nice();return{x:o,y:a}})}function fr(e){var t=!0;if(!e)throw new Error("no callback given");function r(){t||e(t=!0)}function n(){t&&e(t=!1)}"hidden"in document&&(t=!document.hidden,document.addEventListener("visibilitychange",function(){(document.hidden?n:r)()})),"mozHidden"in document&&(t=!document.mozHidden,document.addEventListener("mozvisibilitychange",function(){(document.mozHidden?n:r)()})),"webkitHidden"in document&&(t=!document.webkitHidden,document.addEventListener("webkitvisibilitychange",function(){(document.webkitHidden?n:r)()})),"msHidden"in document&&(t=!document.msHidden,document.addEventListener("msvisibilitychange",function(){(document.msHidden?n:r)()})),"onfocusin"in document&&(document.onfocusin=r,document.onfocusout=n),window.onpageshow=window.onfocus=r,window.onpagehide=window.onblur=n}var lt=fr;function xr({fwdRef:e,title:t,data:r,config:n,slider:o}){let i=hr(),[a,s]=Z(r),l=Ce({title:t,data:a,...n}),d=it(l),x=be(d,l),[m,f,c]=Ue(),[u,p]=Z("default"),[y,v]=Z({}),[z,W]=Z(0),[h,w]=Z(0),k=ur(r,b=>b?.series?.length)?.series?.length,[C,M]=Z(l.initSlices),[Y,D]=C;ve(()=>{M(l.initSlices)},[k]),ve(()=>{s([...r||[]].map(b=>({...b,series:[...b?.series||[]].slice(Math.max(0,k+Y),k+D)})))},[r,Y,D]),ve(()=>{let b=0;lt(ae=>{ae&&w(b++)})},[]);let mt={config:l,frame:d,scales:x,cursor:u,setCursor:p,activeScale:z,setActiveScale:W,dispatch:m,on:f,off:c,menuItems:y,setMenuItems:v},ee=b=>({...b,inInnerChartRange:dt(b.evt.offsetX,d.innerChart.xStart,d.innerChart.xEnd)&&dt(b.evt.offsetY,d.innerChart.yStart,d.innerChart.yEnd)});return T.createElement("div",null,T.createElement(Te,{key:h,ref:e,width:l.width,height:l.height,style:{cursor:u},onContextMenu:b=>b.evt.preventDefault(),onClick:b=>m("click",ee(b)),onMouseDown:b=>m("mousedown",ee(b)),onMouseUp:b=>m("mouseup",ee(b)),onMouseMove:b=>m("mousemove",ee(b))},T.createElement(ce.Provider,{value:mt},T.createElement(re,{ref:i},T.createElement(B,{x:0,y:0,width:l.width,height:l.height,fill:l.theme.bgColor,cornerRadius:l.theme.borderRadius}),T.createElement(Be,null),T.createElement(Ze,null),T.createElement(qe,null),T.createElement(Je,{layerRef:i})),T.createElement(Se,null))),o&&T.createElement("div",{style:{paddingTop:l.theme.slider.padding}},T.createElement(me,{max:k,value:C.map(b=>b+k),onInput:([b,ae])=>{M([b-k,ae-k])},theme:l.theme.slider})))}var To=xr;export{To as default};
//# sourceMappingURL=Chart-DIEG5EIP.mjs.map